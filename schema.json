{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CCR Section Schema",
  "description": "Data structure for extracted California Code of Regulations sections",
  "type": "object",
  "properties": {
    "url": {
      "type": "string",
      "description": "Full URL of the section page",
      "format": "uri",
      "examples": [
        "https://govt.westlaw.com/calregs/Document/I309E34535A0A11EC8227000D3A7C4BC3?viewType=FullText"
      ]
    },
    "guid": {
      "type": "string",
      "description": "Westlaw document GUID (unique identifier)",
      "pattern": "^I[A-F0-9]{32}$",
      "examples": [
        "I309E34535A0A11EC8227000D3A7C4BC3"
      ]
    },
    "section_number": {
      "type": "string",
      "description": "Section number with § symbol",
      "examples": [
        "§ 1031.2",
        "§ 100405"
      ]
    },
    "section_title": {
      "type": "string",
      "description": "Descriptive title of the section",
      "examples": [
        "Advisory Committee",
        "Account Code Numbers",
        "Patents"
      ]
    },
    "citation_short": {
      "type": "string",
      "description": "Short citation format from header",
      "examples": [
        "2 CA ADC § 1031.2",
        "24 CA ADC § 100405"
      ]
    },
    "citation_canonical": {
      "type": "string",
      "description": "Full canonical citation",
      "examples": [
        "Cal. Admin. Code tit. 2, § 1031.2, 2 CA ADC § 1031.2",
        "Cal. Admin. Code tit. 24, § 100405, 24 CA ADC § 100405"
      ]
    },
    "hierarchy": {
      "type": "object",
      "description": "Hierarchical path from Title to Article",
      "properties": {
        "title": {
          "type": [
            "string",
            "null"
          ],
          "description": "Title level (e.g., 'Title 2. Administration')",
          "examples": [
            "Title 2. Administration",
            "Title 24. Building Standards"
          ]
        },
        "division": {
          "type": [
            "string",
            "null"
          ],
          "description": "Division level (optional, may be null)",
          "examples": [
            "Division 2. Financial Operations (Refs & Annos)",
            null
          ]
        },
        "chapter": {
          "type": [
            "string",
            "null"
          ],
          "description": "Chapter level",
          "examples": [
            "Chapter 2. State Controller",
            "Chapter 1. General"
          ]
        },
        "subchapter": {
          "type": [
            "string",
            "null"
          ],
          "description": "Subchapter level (optional, may be null)",
          "examples": [
            "Subchapter 3. Accounting Procedures for Special Districts",
            null
          ]
        },
        "article": {
          "type": [
            "string",
            "null"
          ],
          "description": "Article level (optional, may be null)",
          "examples": [
            "Article 1. General Information",
            null
          ]
        }
      },
      "required": [
        "title"
      ]
    },
    "text_html": {
      "type": "string",
      "description": "Raw HTML of section body (preserves formatting)",
      "examples": [
        "<div class=\"co_paragraphText\">The requirements herein prescribed have been approved by the Advisory Committee...</div>"
      ]
    },
    "text_plain": {
      "type": "string",
      "description": "Plain text version of section body (stripped of HTML)",
      "examples": [
        "The requirements herein prescribed have been approved by the Advisory Committee to the State Controller on Reporting of Financial Transactions of Local Government Agencies, as required by Section 53891 of the Government Code."
      ]
    },
    "currency_notice": {
      "type": [
        "string",
        "null"
      ],
      "description": "Database current-through date notice",
      "examples": [
        "This database is current through 1/9/26 Register 2026, No. 2.",
        null
      ]
    },
    "extraction_status": {
      "type": "string",
      "description": "Status of content extraction",
      "enum": [
        "success",
        "external_redirect",
        "parse_failure",
        "not_found"
      ],
      "default": "success",
      "examples": [
        "success",
        "external_redirect"
      ]
    },
    "extraction_note": {
      "type": [
        "string",
        "null"
      ],
      "description": "Additional context about extraction status (e.g., redirect URL, error message)",
      "examples": [
        "Redirects to California Building Standards Commission (DGS)",
        "Redirects to ICC/NFPA publisher platforms",
        null
      ]
    },
    "external_url": {
      "type": [
        "string",
        "null"
      ],
      "description": "External URL if content redirects outside Westlaw CCR corpus",
      "format": "uri",
      "examples": [
        "https://www.dgs.ca.gov/BSC",
        null
      ]
    },
    "extracted_at": {
      "type": "string",
      "description": "ISO 8601 timestamp when section was processed (crawled or redirect detected)",
      "format": "date-time",
      "examples": [
        "2026-01-31T12:06:19Z"
      ]
    }
  },
  "required": [
    "url",
    "guid",
    "section_number",
    "section_title",
    "hierarchy",
    "extraction_status",
    "extracted_at"
  ],
  "additionalProperties": false,
  "allOf": [
    {
      "if": {
        "properties": {
          "extraction_status": {
            "const": "success"
          }
        }
      },
      "then": {
        "required": [
          "text_plain"
        ]
      }
    }
  ]
}